---
import { getSiteContent } from "../content/utils";
import { locales } from "../config/locales";
import { buildLocalizedPath } from "../config/shared";
import { DEFAULT_LANGUAGE, t, type Language } from "../i18n/utils";

interface Props {
  lang?: Language;
  showHome?: boolean;
  isStaticPage?: boolean;
}

const { lang = DEFAULT_LANGUAGE, showHome = true, isStaticPage = false } = Astro.props as Props;

const siteContent = await getSiteContent(lang);

const hasLanguages = siteContent.languages && siteContent.languages.length > 0;
const hasExperience = siteContent.projects && siteContent.projects.length > 0;
const hasExpertise = siteContent.skills && siteContent.skills.length > 0;

const getNavLink = (key: string) => t(lang, `nav.${key}`);
const getLanguageUrl = (localeCode: Language) => buildLocalizedPath(localeCode);
const homeUrl = buildLocalizedPath(lang);
const homeLabel = lang === 'de' ? 'Home' : 'Home';
const contactHref = siteContent.social?.email
  ? `mailto:${siteContent.social.email}`
  : '#';
const contactLabel = lang === 'de' ? 'Kontakt' : 'Contact';
---

<header
  id="header"
  class="fixed top-0 left-0 right-0 z-50 hidden md:block transition-all duration-300"
>
  <nav class="max-w-7xl mx-auto px-8 py-4">
    <ul class="flex items-center gap-8 justify-center">
      {
        showHome && (
          <li>
            <a
              href={homeUrl}
              class="text-gray-700 hover:text-black transition-colors font-medium"
            >
              {homeLabel}
            </a>
          </li>
        )
      }
      {
        hasExpertise && (
          <li>
            <a
              href={isStaticPage ? `${homeUrl}#expertise` : "#expertise"}
              class="text-gray-700 hover:text-black transition-colors font-medium"
            >
              {getNavLink('expertise')}
            </a>
          </li>
        )
      }
      {
        hasExperience && (
          <li>
            <a
              href={isStaticPage ? `${homeUrl}#experience` : "#experience"}
              class="text-gray-700 hover:text-black transition-colors font-medium"
            >
              {getNavLink('experience')}
            </a>
          </li>
        )
      }
      {
        hasLanguages && (
          <li>
            <a
              href={isStaticPage ? `${homeUrl}#languages` : "#languages"}
              class="text-gray-700 hover:text-black transition-colors font-medium"
            >
              {getNavLink('languages')}
            </a>
          </li>
        )
      }
      <li class="ml-4 pl-4 border-l border-gray-300">
        <div class="flex gap-1 bg-gray-100 rounded-lg p-1">
          {locales.map((localeOption) => (
            <a
              href={getLanguageUrl(localeOption.code)}
              class={`h-10 px-3 flex items-center justify-center rounded transition-all font-medium text-sm ${
                lang === localeOption.code
                  ? 'bg-white text-black shadow-sm'
                  : 'text-gray-600 hover:text-gray-800'
              }`}
              lang={localeOption.hrefLang}
              aria-label={localeOption.name}
              title={localeOption.name}
            >
              {localeOption.code.toUpperCase()}
            </a>
          ))}
        </div>
      </li>
      <li>
        <a
          href={contactHref}
          class="ml-4 inline-flex items-center justify-center rounded-lg bg-black px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:-translate-y-0.5 hover:shadow-md"
        >
          {contactLabel}
        </a>
      </li>
    </ul>
  </nav>
</header>

<script>
  window.addEventListener("scroll", () => {
    const header = document.getElementById("header");
    if (window.scrollY > 100) {
      header?.classList.add("bg-white/80", "backdrop-blur-sm");
    } else {
      header?.classList.remove("bg-white/80", "backdrop-blur-sm");
    }
  });
</script>

<style>
  html {
    scroll-behavior: smooth;
  }
</style>
